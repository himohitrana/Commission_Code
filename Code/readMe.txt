1. parseRow: This function takes a row of input as a string and parses it into individual columns. It checks for empty rows and throws an exception if the input format is invalid. It extracts the card number, amount, and currency from the columns and returns them as an associative array.
2. extractValue: This function takes a column as a string and extracts the value from it. It splits the column using the colon (':') delimiter and throws an exception if the input format is invalid. It returns the trimmed value.
3. isEu: This function takes a country code as a parameter and checks if it belongs to the EU countries. It compares the country code with a list of EU countries and returns true if it matches, false otherwise.
4. convertCurrency: This function takes an amount and a currency as parameters. It fetches the latest exchange rates using the "exchangeratesapi.io" API. It retrieves the exchange rate for the given currency and converts the amount to Euros (EUR) if the currency is not EUR or the rate is zero. It returns the converted amount.
5. calculateTransactionFee: This function calculates the transaction fee based on the card number, amount, and currency. It retrieves additional information about the card from the "binlist.net" API using the card number. It determines if the country associated with the card is in the EU using the isEu() function. It then converts the amount to Euros using the convertCurrency() function and calculates the fee rate based on whether it's an EU transaction or not. It returns the calculated transaction fee.
6. processInputFile: This function processes the input file specified by the given file path. It opens the file for reading and iterates over each row. It uses the parseRow() function to parse each row into transaction data. If the transaction data is null (empty row), it continues to the next row. Otherwise, it calls calculateTransactionFee() with the transaction data and echoes the calculated fee. If an exception occurs during the calculation, it logs the error message.
7. The code at the bottom of the file retrieves the input file path from the command line arguments ($argv[1]) and passes it to the processInputFile() function.